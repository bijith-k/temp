import{r as s,u as y,b as C,c as e,F as k,j as l,d as g,g as P,S,e as O,N as V}from"./index-75e0cb1c.js";import{u as I}from"./user-4891dc53.js";import{f as Y,l as q,C as z,M as G}from"./MessageSkeleton-48d70a0a.js";import{H as J}from"./Header-318919e1.js";import{H as K}from"./HeadTitle-2e5ed730.js";import{F as Q}from"./Footer-62cbe905.js";import"./logoWhite-701db893.js";const U=({conversation:r,currentUser:n})=>{const[d,i]=s.useState([]),b=y(),o=C();return s.useEffect(()=>{const u=r.members.find(c=>c!==n._id);(async()=>{try{const c=await g("Stoken").get(`get-tutors?id=${u}`);c.data.status==!1?(localStorage.removeItem("Stoken"),b("/signin")):i(c.data)}catch(c){console.log(c),o({title:c.message,status:"error",duration:5e3,isClosable:!0,position:"top"})}})()},[n,r]),e(k,{children:d.map((u,m)=>l("div",{className:"flex items-center p-3 cursor-pointer hover:bg-gray-400 mt-5",children:[e("img",{src:u.profilePicture?`http://localhost:4000/${u.profilePicture}`:I,alt:"",className:"w-10 h-10 rounded-full object-cover mr-5"}),e("span",{className:"font-medium",children:u.name})]},m))})},X=({message:r,own:n,sendBy:d})=>{var m;const[i,b]=s.useState([]),o=y(),u=C();return s.useEffect(()=>{d&&(async()=>{try{const f=await g("Stoken").get(`get-tutors?id=${d}`);f.data.status==!1?(localStorage.removeItem("Stoken"),o("/signin")):b(f.data)}catch(f){console.log(f),u({title:f.message,status:"error",duration:5e3,isClosable:!0,position:"top"})}})()},[]),l("div",{className:`flex flex-col mt-5 ${n?"items-end":null}`,children:[l("div",{className:" flex",children:[e("img",{src:(m=i[0])!=null&&m.profilePicture?`http://localhost:4000/${i[0].profilePicture}`:I,alt:"",className:`w-8 h-8 rounded-full object-cover mr-3 ${n?"hidden":null}`}),e("p",{className:`p-3 rounded-3xl ${n?"bg-blue-200 text-black":"bg-blue-500 text-white"}  max-w-xs`,children:r.text})]}),e("div",{className:"text-xs mt-3",children:Y(r.createdAt)})]})},Z=()=>e(P,{className:"",children:l(P,{padding:"6",boxShadow:"lg",className:"mt-0 mx-auto h-fit w-80 md:w-56 ",children:[e(S,{height:"25",mt:"6",className:"mx-auto"}),e(S,{height:"30",mt:"6",className:"mx-auto"}),e(S,{height:"30",mt:"6",className:"mx-auto"}),e(S,{height:"30",mt:"6",className:"mx-auto"})]})}),ne=()=>{var M,j;const{student:r}=O(t=>t.student),n=y(),d=C(),[i,b]=s.useState([]),[o,u]=s.useState(null),[m,c]=s.useState([]),[f,$]=s.useState(""),[v,L]=s.useState(null),[N,F]=s.useState([]),[H,w]=s.useState(!0),[R,T]=s.useState(!0),[A,_]=s.useState(!0),[D,B]=s.useState(!1),p=s.useRef(),E=s.useRef();s.useEffect(()=>{p.current=q("http://localhost:4000/"),p.current.emit("add-user",r._id)},[r]),s.useEffect(()=>{(async()=>{const{data:a}=await g("Stoken").get("plan-details");a.status==!1?(d({title:a.message,status:"error",duration:5e3,isClosable:!0,position:"top"}),localStorage.removeItem("Stoken"),n("/signin")):(B(a.subscribed),w(!1))})()},[]),s.useEffect(()=>{(async()=>{try{const a=await g("Stoken").get(`get-conversation/${r._id}`);a.data.status==!1?(d({title:a.data.message,status:"error",duration:5e3,isClosable:!0,position:"top"}),localStorage.removeItem("Stoken"),n("/signin")):(b(a.data),w(!1),T(!1))}catch(a){w(!1),T(!1),console.log(a),d({title:a.message,status:"error",duration:5e3,isClosable:!0,position:"top"})}})()},[r._id]),s.useEffect(()=>{(async()=>{try{const a=await g("Stoken").get(`get-message/${o==null?void 0:o._id}`);a.data.status==!1?(localStorage.removeItem("Stoken"),n("/signin")):(c(a.data),_(!1))}catch(a){console.log(a),_(!1),d({title:a.message,status:"error",duration:5e3,isClosable:!0,position:"top"})}})()},[o]);const W=async t=>{t.preventDefault();const a={sender:r._id,text:f,conversationId:o._id},h=o.members.find(x=>x!==r._id);p.current.emit("send-msg",{receiverId:h,senderId:r._id,text:f});try{const x=await g("Stoken").post("new-message",a);c([...m,x.data]),$("")}catch(x){console.log(x)}};return s.useEffect(()=>{p.current&&p.current.on("msg-receive",t=>{L({sender:t.senderId,text:t.text,createdAt:Date.now()})})},[]),s.useEffect(()=>{const t=o==null?void 0:o.members.find(h=>h!==r._id);(async()=>{try{if(t){const h=await g("Stoken").get(`get-tutors?id=${t}`);h.data.status==!1?(localStorage.removeItem("Stoken"),n("/signin")):F(h.data)}}catch(h){d({title:h.message,status:"error",duration:5e3,isClosable:!0,position:"top"})}})()},[o]),s.useEffect(()=>{v&&(o!=null&&o.members.includes(v.sender))&&c(t=>[...t,v])},[v,o]),s.useEffect(()=>{var t;(t=E.current)==null||t.scrollIntoView({behavior:"smooth"})},[m]),l("div",{className:"min-h-screen max-w-screen-2xl mx-auto w-full pt-16 bg-[#d4d8f0] overflow-x-hidden",children:[e(V,{}),e(J,{}),e(K,{title:"chats"}),H?e(z,{}):e("div",{children:D?l("div",{className:"flex-grow  md:h-96 flex flex-col md:flex-row",children:[l("div",{className:"flex p-3 flex-col  bg-slate-300 overflow-y-auto scrollbar-track-transparent scrollbar-thin scrollbar-thumb-slate-700 ",children:[e("p",{className:"font-bold p-3 border-b-2 text-center text-lg",children:"Recent conversations"}),R?e("div",{children:e(Z,{})}):e("div",{children:(i==null?void 0:i.length)>0?e("div",{children:i==null?void 0:i.map((t,a)=>e("div",{onClick:()=>u(t),children:e(U,{conversation:t,currentUser:r})},a))}):l("div",{className:"my-10",children:[e("p",{className:"font-semibold text-center text-black cursor-default",children:"There is no conversations"})," "]})})]}),e("div",{className:"flex-grow ",children:e("div",{className:"flex flex-col h-full  border-l-0 md:border-l-4 border-0",id:"chatBoxWrapper",children:o?l(k,{children:[l("div",{className:"w-full h-16 bg-[#19376D] flex flex-row items-center justify-start",children:[e("div",{className:"mx-4  border-white border-2 rounded-full",children:e("img",{src:(M=N[0])!=null&&M.profilePicture?`http://localhost:4000/${N[0].profilePicture}`:I,className:"rounded-full w-10 h-10 ",alt:"img"})}),e("div",{children:e("p",{className:"font-semibold text-lg text-white",children:(j=N[0])==null?void 0:j.name})})]}),A?e(G,{}):l(k,{children:[e("div",{id:"chatbox top",className:"p-3 overflow-x-hidden h-96 flex-grow overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-transparent",children:m.map((t,a)=>e("div",{ref:E,children:e(X,{message:t,sendBy:t.sender!=r._id?t.sender:null,own:t.sender===r._id})},a))}),l("div",{className:"mt-1 w-full flex items-center justify-center",id:"chatboxbottom",children:[e("textarea",{placeholder:"Write something",className:"w-10/12 h-12 p-3 scrollbar-thin scrollbar-thumb-blue-700 scrollbar-track-blue-300",onChange:t=>$(t.target.value),value:f}),e("button",{className:"w-2/12 h-12 border-none cursor-pointer bg-teal-800 text-white",onClick:W,children:"Send"})]})]})]}):e("span",{className:"text-center font-bold text-xl my-20",children:"Open a conversation to start a chat"})})})]}):l("div",{className:"h-52 flex flex-col items-center",children:[e("p",{className:"text-center font-bold text-2xl mt-10",children:"You are not subscribed to access chat"}),e("button",{className:"bg-[#eebbc3] p-2 rounded-lg uppercase mt-4 font-bold",onClick:()=>n("/plans"),children:"check plans"})]})}),e("div",{className:"mt-1",children:e(Q,{})})]})};export{ne as default};
